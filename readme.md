# üéå AniReco: Semantic Anime Recommendation System

**AniReco** ‚Äî —ç—Ç–æ –≤—ã—Å–æ–∫–æ—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–Ω–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞, –∏—Å–ø–æ–ª—å–∑—É—é—â–∞—è –º–µ—Ç–æ–¥—ã –≥–ª—É–±–æ–∫–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è (NLP) –¥–ª—è –ø–æ–∏—Å–∫–∞ –∞–Ω–∏–º–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–º—ã—Å–ª–∞, –∞—Ç–º–æ—Å—Ñ–µ—Ä—ã –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ–≥–æ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Ç–µ–≥–æ–≤.

---

## üß† Machine Learning Deep Dive (Data Science focus)

–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞ ‚Äî –¥–æ–º–µ–Ω–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è —è–∑—ã–∫–æ–≤–æ–π –º–æ–¥–µ–ª–∏ –¥–ª—è –∑–∞–¥–∞—á–∏ Similarity Search. –û—Å–Ω–æ–≤–Ω–æ–π —É–ø–æ—Ä –±—ã–ª —Å–¥–µ–ª–∞–Ω –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞, –≥–¥–µ –ø–æ—Ö–æ–∂–∏–µ –ø–æ –¥—É—Ö—É –∞–Ω–∏–º–µ –≥—Ä—É–ø–ø–∏—Ä—É—é—Ç—Å—è –≤ –∫–ª–∞—Å—Ç–µ—Ä—ã.

### 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–¥–µ–ª–∏
–í –∫–∞—á–µ—Å—Ç–≤–µ —ç–Ω–∫–æ–¥–µ—Ä–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –º–æ–¥–µ–ª—å **all-MiniLM-L6-v2**. –ü–æ–≤–µ—Ä—Ö –Ω–µ—ë –±—ã–ª–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∫–∞—Å—Ç–æ–º–Ω–∞—è –ø—Ä–æ–µ–∫—Ü–∏–æ–Ω–Ω–∞—è "–≥–æ–ª–æ–≤–∞" (MLP Head) –¥–ª—è —Ç–æ–Ω–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–µ—Å–æ–≤ –ø–æ–¥ –∞–Ω–∏–º–µ-–∫–æ–Ω—Ç–µ–Ω—Ç:
- **Input:** 384-–º–µ—Ä–Ω—ã–π –≤–µ–∫—Ç–æ—Ä MiniLM.
- **Hidden Layers:** Linear(384, 256) -> BatchNorm -> ReLU -> Dropout(0.4).
- **Output:** 256-–º–µ—Ä–Ω—ã–π —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π —ç–º–±–µ–¥–¥–∏–Ω–≥.
- **Normalization:** –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è L2-–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã—Ö–æ–¥–Ω–æ–≥–æ –≤–µ–∫—Ç–æ—Ä–∞ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã –∫–æ—Å–∏–Ω—É—Å–Ω–æ–≥–æ —Å—Ö–æ–¥—Å—Ç–≤–∞ –≤ –≤–µ–∫—Ç–æ—Ä–Ω–æ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ.

### 2. –°—Ç—Ä–∞—Ç–µ–≥–∏—è –æ–±—É—á–µ–Ω–∏—è: Triplet Margin Loss
–î–ª—è –æ–±—É—á–µ–Ω–∏—è –±—ã–ª–∞ –≤—ã–±—Ä–∞–Ω–∞ –∫–æ–Ω—Ü–µ–ø—Ü–∏—è **Contrastive Learning**. –ú–æ–¥–µ–ª—å —É—á–∏—Ç—Å—è –Ω–µ –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å, –∞ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞—Ç—å. –ö–∞–∂–¥–∞—è –æ–±—É—á–∞—é—â–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è ‚Äî —ç—Ç–æ —Ç—Ä–æ–π–∫–∞ (Triplet):
- **Anchor (–Ø–∫–æ—Ä—å):** –¶–µ–ª–µ–≤–æ–µ –∞–Ω–∏–º–µ.
- **Positive (–î—Ä—É–≥):** –ê–Ω–∏–º–µ —Å –≤—ã—Å–æ–∫–æ–π –∂–∞–Ω—Ä–æ–≤–æ–π –∏ —Å–º—ã—Å–ª–æ–≤–æ–π —Å—Ö–æ–∂–µ—Å—Ç—å—é.
- **Negative (–í—Ä–∞–≥):** –ê–Ω–∏–º–µ-–∞–Ω—Ç–∞–≥–æ–Ω–∏—Å—Ç.

### 3. Hard Negative Mining & Jaccard Similarity
–î–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –º–æ–¥–µ–ª—å "–≤—á–∏—Ç—ã–≤–∞–ª–∞—Å—å" –≤ —Å–∏–Ω–æ–ø—Å–∏—Å, –±—ã–ª–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è **—Å–ª–æ–∂–Ω—ã—Ö –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤**:
- –°—Ö–æ–¥—Å—Ç–≤–æ –º–µ–∂–¥—É –∞–Ω–∏–º–µ –≤—ã—á–∏—Å–ª—è–ª–æ—Å—å —á–µ—Ä–µ–∑ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –ñ–∞–∫–∫–∞—Ä–∞ (Jaccard) –Ω–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–∞—Ö –∂–∞–Ω—Ä–æ–≤.
- **Positive:** Jaccard score ‚â• 0.6.
- **Hard Negative:** Jaccard score –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ 0.1 ‚Äî 0.3. –≠—Ç–æ –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç –º–æ–¥–µ–ª—å –∏—Å–∫–∞—Ç—å —Ç–æ–Ω–∫–∏–µ —Ä–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É –∞–Ω–∏–º–µ, –∫–æ—Ç–æ—Ä—ã–µ –∏–º–µ—é—Ç –æ–±—â–∏–µ —Ç–µ–≥–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "Action"), –Ω–æ –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è –ø–æ —Å—é–∂–µ—Ç—É.

### 4. Natural Language Augmentation (Story Format)
–î–ª—è –±–æ—Ä—å–±—ã —Å –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ–º –Ω–∞ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤–∞—Ö (–∂–∞–Ω—Ä–∞—Ö) –±—ã–ª–∞ –≤–Ω–µ–¥—Ä–µ–Ω–∞ –∞—É–≥–º–µ–Ω—Ç–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–æ–≤. –°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ MyAnimeList –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤—ã–≤–∞–ª–∏—Å—å –≤ —Å–≤—è–∑–Ω–æ–µ –ø–æ–≤–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ: 
*¬´This is an Action anime titled Naruto. The story follows a young ninja...¬ª*. 
–≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏–ª–æ –º–æ–¥–µ–ª–∏ –ª—É—á—à–µ –æ–±–æ–±—â–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏ –ø–æ–Ω–∏–º–∞—Ç—å –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

### 5. Pooling Strategy
–í–º–µ—Å—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ CLS-—Ç–æ–∫–µ–Ω–∞ –≤–Ω–µ–¥—Ä–µ–Ω **Mean Pooling** —Å —É—á–µ—Ç–æ–º `attention_mask`. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —É—Å—Ä–µ–¥–Ω—è—Ç—å –∑–Ω–∞—á–∏–º—ã–µ –≤–µ–∫—Ç–æ—Ä—ã –≤—Å–µ—Ö —Å–ª–æ–≤ –≤ —Å–∏–Ω–æ–ø—Å–∏—Å–µ, –∏–≥–Ω–æ—Ä–∏—Ä—É—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ—Ç—Å—Ç—É–ø—ã (padding), —á—Ç–æ –¥–∞–µ—Ç –±–æ–ª–µ–µ —É—Å—Ç–æ–π—á–∏–≤—ã–π –≤–µ–∫—Ç–æ—Ä –≤—Å–µ–≥–æ —Ç–µ–∫—Å—Ç–∞.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ú–æ–¥–µ–ª—å –¥–æ—Å—Ç–∏–≥–ª–∞ **87.6% Validation Accuracy** (Correct Ranking) –Ω–∞ –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–π –≤—ã–±–æ—Ä–∫–µ.

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–∞–∫ –º–æ–¥—É–ª—å–Ω—ã–π –º–æ–Ω–æ–ª–∏—Ç, –≥–æ—Ç–æ–≤—ã–π –∫ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–º—É –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é.

- **ML Core:** PyTorch, Transformers, Sentence-Transformers.
- **Vector Engine:** **Qdrant** ‚Äî –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ–∏—Å–∫ –ø–æ 4680+ –≤–µ–∫—Ç–æ—Ä–∞–º –∑–∞ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã.
- **Hybrid Search:** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∞–ª–≥–æ—Ä–∏—Ç–º **RRF (Reciprocal Rank Fusion)** –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–µ–π—Ä–æ–Ω–Ω–æ–π —Å–µ—Ç–∏ –∏ –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞ PostgreSQL.
- **Backend:** **FastAPI** (–ø–æ–ª–Ω–æ—Å—Ç—å—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∏–Ω—Ñ–µ—Ä–µ–Ω—Å), SQLAlchemy 2.0, Pydantic v2.
- **Frontend:** **React 18**, TypeScript, Vite, Tailwind CSS, Shadcn/UI.

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```text
AniReco/
‚îú‚îÄ‚îÄ backend/                # FastAPI Application
‚îÇ   ‚îî‚îÄ‚îÄ app/
‚îÇ       ‚îú‚îÄ‚îÄ api/            # REST Endpoints & Dependencies (Depends)
‚îÇ       ‚îú‚îÄ‚îÄ db/             # Database Connectors (Postgres, Qdrant)
‚îÇ       ‚îú‚îÄ‚îÄ config.py       # Pydantic Settings & Env management
‚îÇ       ‚îú‚îÄ‚îÄ schemas.py      # Data Validation Models
‚îÇ       ‚îî‚îÄ‚îÄ services.py     # Hybrid Logic & Business rules
‚îú‚îÄ‚îÄ frontend/               # React (Vite + TS)
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/     # UI: AnimeCards (Flip effect), SearchFilters
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ App.tsx         # Global State & API Integration
‚îú‚îÄ‚îÄ src/                    # ML Development Core
‚îÇ   ‚îú‚îÄ‚îÄ model/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ architecture.py # Neural Network Definition
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ train_model.py  # Triplet Loss Training Pipeline
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ inference.py    # Prediction Service (Vectorization)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ my_anime_dataset.py # Custom Dataset & Tokenization
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ       ‚îî‚îÄ‚îÄ utils.py        # Text Cleaning, Jaccard & Augmentation
‚îú‚îÄ‚îÄ scripts/                # Infrastructure Scripts
‚îÇ   ‚îú‚îÄ‚îÄ init_db.py          # SQL Migrations
‚îÇ   ‚îú‚îÄ‚îÄ seed_qdrant.py      # Vector Migration & Payload Enrichment
‚îÇ   ‚îî‚îÄ‚îÄ parser_mal.py       # Data Gathering Script
‚îú‚îÄ‚îÄ data/                   # Data Storage
‚îÇ   ‚îú‚îÄ‚îÄ processed/          # Parquet Clean Datasets
‚îÇ   ‚îî‚îÄ‚îÄ embeddings/         # Model Weights (.pt) & Vectors (.npy)
‚îú‚îÄ‚îÄ Dockerfile              # Containerization
‚îî‚îÄ‚îÄ docker-compose.yml      # Multi-container Orchestration
```

---
## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

```
make setup
```
